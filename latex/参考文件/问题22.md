## 2.4 NIPT时点计算

### 2.4.1 方法原理与模型构建

为确定各BMI分组的最佳NIPT检测时点，本研究构建了一个基于风险-效用权衡的优化模型。该模型综合考虑了早期检测与晚期检测的双重风险，通过数学优化方法寻找使总体风险最小化的检测时间点。

**风险函数定义**：

- **早期检测风险(R_early)**：检测时间过早可能导致Y染色体浓度尚未达标，造成假阴性结果。我们采用指数衰减函数模拟这一风险：
  \[
  R_{\text{early}}(t) = 2.0 \cdot e^{-t/50}
  \]
  该函数从初始值2.0开始，随孕期增加呈指数衰减，反映早期预测的高风险性。

- **晚期检测风险(R_late)**：检测时间过晚则可能错过最佳干预时机。我们采用分段函数描述这一风险：
  \[
  R_{\text{late}}(t) = 
  \begin{cases} 
  0.1 & t < 84 \\
  0.1 + 0.9 \cdot \left( \frac{t-84}{189-84} \right)^2 & 84 \leq t \leq 189 \\
  1.0 & t > 189
  \end{cases}
  \]
  该函数在84天前保持低风险(0.1)，84-189天间以二次函数形式增长，189天后达到最高风险(1.0)。

**效用函数构建**：
基于累积达标概率F(t)（通过Kaplan-Meier估计器计算）和上述风险函数，我们构建综合效用函数：
\[
U(t) = (1 - F(t)) \cdot R_{\text{early}}(t) + F(t) \cdot R_{\text{late}}(t)
\]
其中F(t)表示在时间t之前Y染色体浓度达到4%的累积概率。

**优化目标**：
通过最小化效用函数U(t)确定最佳检测时点：
\[
t^* = \arg\min_{t \in [0, T_{\text{max}}]} U(t)
\]
其中T_max为观察期上限。

### 2.4.2 计算流程与实施

本研究采用以下步骤计算各BMI分组的最佳NIPT时点：

1. **数据准备与分组**：基于聚类分析得到的5个BMI区间，将样本分为相应组别。
2. **生存分析**：对每个BMI分组，应用Kaplan-Meier方法估计累积达标函数F(t)，处理右删失数据（始终达标组和从不达标组）。
3. **效用函数计算**：在时间域[0, T_max]上离散采样，计算各时间点的效用值U(t)。
4. **优化求解**：采用有界优化算法（Bounded方法）寻找使U(t)最小化的时间点t*。
5. **误差分析**：通过蒙特卡洛模拟（100次重复）评估检测误差对最优时点稳定性的影响。

### 2.4.3 结果与分析

表2展示了各BMI分组的最佳NIPT时点及相应指标：

**表2：各BMI分组最佳NIPT时点计算结果**

| BMI分组     | 最优时点(天) | 最小效用值 | 风险水平 | 样本量 |
| ----------- | ------------ | ---------- | -------- | ------ |
| <30.26      | 89.5         | 0.1299     | 7.6965   | 59     |
| 30.26-32.30 | 90.8         | 0.1360     | 7.3511   | 68     |
| 32.30-34.92 | 90.8         | 0.1359     | 7.3591   | 69     |
| 34.92-39.49 | 99.4         | 0.1569     | 6.3753   | 33     |
| >39.49      | 110.7        | 0.1884     | 5.3090   | 4      |

结果表明，随着BMI增加，最佳检测时点相应延后，而效用值逐渐增加（风险水平降低）。这一趋势与临床观察一致，高BMI孕妇需要更长时间等待Y染色体浓度达标，但一旦达标，其检测风险相对较低。

图3展示了BMI分组"34.92-39.49"的典型分析结果，包括累积达标曲线、效用函数曲线及最优时点标注。

**图3：BMI区间34.92-39.49的达标情况与效用分析**
（图中包含：累积达标函数曲线、效用函数曲线、最优时点标注及早期/过渡/晚期阶段背景色区分）

### 2.4.4 误差敏感性分析

为评估检测误差对结果稳定性的影响，我们进行了蒙特卡洛模拟分析。假设检测误差服从正态分布（标准差=5%），对每个BMI分组进行100次重复模拟。

表3a和表3b展示了误差分析结果：

**表3a：检测误差对最优时点的影响分析（时点相关指标）**

| BMI分组     | 原始最优时点(天) | 模拟最优时点均值(天) | 时点标准差(天) | 95%置信区间(天)  |
| ----------- | ---------------- | -------------------- | -------------- | ---------------- |
| <30.26      | 89.51            | 90.05                | 1.56           | (89.74, 90.35)   |
| 30.26-32.30 | 90.79            | 92.64                | 2.52           | (92.14, 93.13)   |
| 32.30-34.92 | 90.76            | 91.19                | 1.39           | (90.92, 91.46)   |
| 34.92-39.49 | 99.44            | 100.04               | 2.37           | (99.58, 100.51)  |
| >39.49      | 110.75           | 110.11               | 3.49           | (109.43, 110.79) |

**表3b：检测误差对最优时点的影响分析（效用值与风险水平相关指标）**

| BMI分组     | 原始最小效用值 | 模拟最小效用值均值 | 效用值标准差 | 原始风险水平 | 模拟风险水平均值 | 风险水平标准差 |
| ----------- | -------------- | ------------------ | ------------ | ------------ | ---------------- | -------------- |
| <30.26      | 0.1299         | 0.1274             | 0.0023       | 7.6965       | 7.8546           | 0.1448         |
| 30.26-32.30 | 0.1360         | 0.1322             | 0.0032       | 7.3511       | 7.5677           | 0.1808         |
| 32.30-34.92 | 0.1359         | 0.1336             | 0.0021       | 7.3591       | 7.4851           | 0.1199         |
| 34.92-39.49 | 0.1569         | 0.1594             | 0.0027       | 6.3753       | 6.2773           | 0.1072         |
| >39.49      | 0.1884         | 0.1829             | 0.0124       | 5.3090       | 5.4973           | 0.4362         |

结果表明：

1. 检测误差对最优时点的影响较小（时点变异系数<3.5%），模型具有较好的稳健性。
2. 高BMI分组对检测误差更为敏感，时点波动范围更大。
3. 所有分组的95%置信区间范围合理，验证了推荐时点的可靠性。
4. 效用值和风险水平的变异程度相对较小，表明模型对这些指标的预测较为稳定。

图4展示了误差模拟的详细结果，包括时点分布、效用值分布及风险分布。

**图4：BMI区间34.92-39.49的误差分析结果**
（包含四个子图：最优时点分布、最小效用值分布、时点-效用值关系散点图、风险水平分布）

### 2.4.5 创新与亮点

本研究在NIPT时点计算方面具有以下创新点：

1. **综合风险建模**：首次将早期检测风险与晚期检测风险同时纳入考量，构建了更符合临床实际的效用函数。
2. **生存分析方法应用**：采用Kaplan-Meier方法处理右删失数据，提高了累积达标概率估计的准确性。
3. **蒙特卡洛误差分析**：通过模拟检测误差的影响，量化了模型的稳健性，为临床决策提供了可靠性评估。
4. **BMI分层优化**：针对不同BMI群体分别计算最优时点，实现了个性化检测推荐。

本研究提供的NIPT时点推荐方案，不仅考虑了检测准确性，还综合评估了时间相关的风险因素，为临床实践提供了科学依据。结果表明，基于BMI分层的个性化检测时点选择，能够有效降低孕妇的潜在风险，提高检测效率。

***参考文献***
[1] Kaplan, E. L.; Meier, P. (1958). "Nonparametric estimation from incomplete observations". Journal of the American Statistical Association. 53 (282): 457–481.
[2] Virtanen, P. et al. (2020). "SciPy 1.0: Fundamental Algorithms for Scientific Computing in Python". Nature Methods. 17: 261–272.
[3] Davidson-Pilon, C. (2019). "Lifelines: Survival Analysis in Python". Journal of Open Source Software. 4(40): 1317.